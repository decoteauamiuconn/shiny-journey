<!DOCTYPE HTML>
<html xmlns:th="https://www.thymeleaf.org">
<head> 
    <title>Quiz Questions</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style>
        .question-container {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
        }
        .answer-feedback {
            display: none;
            margin-top: 10px;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>Quiz Questions</h1>
    <form id="quizForm" th:action="@{/submit-quiz}" method="post">
        <div th:each="question, stat : ${questions}" class="question-container">
            <h3 th:text="'Question ' + ${stat.count}"></h3>
            <p th:text="${question.question}"></p>
            <input type="radio" th:name="'answer' + ${stat.index}" value="true" required>
            <label>True</label><br>
            <input type="radio" th:name="'answer' + ${stat.index}" value="false">
            <label>False</label>
            <div class="answer-feedback" th:id="'feedback' + ${stat.index}"></div>
        </div>
        <button type="submit">Submit All Answers</button>
    </form>

   <script>
        document.getElementById('quizForm').onsubmit = function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch(this.action, { // use form's action so context path is applied
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(data => {
                data.results.forEach((result, index) => {
                    const feedback = document.getElementById('feedback' + index);
                    feedback.textContent = result.correct ? 
                        'Correct!' : 'Incorrect. The correct answer is ' + result.correctAnswer;
                    feedback.className = 'answer-feedback ' + (result.correct ? 'correct' : 'incorrect');
                    feedback.style.display = 'block';
                });
            })
            .catch(err => {
                console.error('Submit error:', err);
                alert('There was a problem submitting the quiz. Please try again.');
            });
        };
    </script>
</body>
</html>